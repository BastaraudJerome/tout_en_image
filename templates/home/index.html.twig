{% extends 'base.html.twig' %}

{% block title %}Tout En Image{% endblock %}

{% block body %}

    
    
    <!-- Carousel Photo -->
        {% if photos|length > 0 %}
            <div id="monCarousel" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                        {% for photo in photos %}
                        <div class="carousel-caption titre">
                                <div class="text-center text-light">
                                        {% if homeContent.titre is defined and homeContent.titre is not null %}
                                        <h1 class="display-1 fw-bolder">
                                            {{ homeContent.titre }}
                                        </h1>
                                    {% endif %}
                                    <p class="lead fw-normal text-white-50">
                                        {% if homeContent.soustitre is defined and homeContent.sousTitre is not null %}
                                            {{ homeContent.sousTitre }}
                                        </p>
                                    {% endif %}
                                </div>
                        </div>
                            <div class="carousel-item {% if loop.index == 1 %} active {% endif %}">
                                <a href="{{ path('photo') }}">
                                    <img src="{{ asset('images/photos/' ~ photo.imageName ) }}" class="d-block w-100" style="height:600px;width:600px" alt="{{ photo.titre }}" />
                                </a>
                                <div class="carousel-caption">
                                    <h1 class="titre-carousel">{{ photo.titre }}</h1>
                                    <h3 class="titre-carousel">{{photo.description}}</h3>
                                </div>
                            </div>      
                        {% endfor %}
                </div>
                
                <div class="carousel-indicators">
                    <button
                    type="button"
                    data-bs-target="#monCarousel"
                    data-bs-slide-to="0"
                    class="active"
                    aria-current="true"
                    aria-label="Slide 1"
                    >
                    </button>
                    <button
                    type="button"
                    data-bs-target="#monCarousel"
                    data-bs-slide-to="1"
                    aria-label="Slide 2"
                    >
                    </button>
                    <button
                    type="button"
                    data-bs-target="#monCarousel"
                    data-bs-slide-to="2"
                    aria-label="Slide 3"
                    >
                    </button>
                    <button
                    type="button"
                    data-bs-target="#monCarousel"
                    data-bs-slide-to="3"
                    aria-label="Slide 4"
                    >
                    </button>
                </div>
                <button
                    class="carousel-control-prev"
                    type="button"
                    data-bs-target="#monCarousel"
                    data-bs-slide="prev"
                >
                    <i class="carousel-control-prev-icon" aria-hidden="true"></i>
                    <i class="visually-hidden">Previous</i>
                </button>
                <button
                    class="carousel-control-next"
                    type="button"
                    data-bs-target="#monCarousel"
                    data-bs-slide="next"
                >
                    <i class="carousel-control-next-icon" aria-hidden="true"></i>
                    <i class="visually-hidden">Next</i>
                </button>
            </div>
        {% endif %}
        <!-- Fin carousel photo -->
  

        {% if videos|length > 0 %}
            <h2 class="text-center mt-3">Nos dernières videos </h2>   
            <div class="row row-cols-1 row-cols-md-2 g-0 m-5">
                {% for video in videos %}
                    <div class="card m-3 move" style="width: 30rem;">
                            <a href="{{path('VideoComments',{'id': video.id})}}">
                                <video width="100%" height="100%" controls>
                                    <source src="{{ asset('images/videos/' ~ video.videoName ) }}" alt="{{ video.titre }}" type="video/mp4" >
                                </video>
                            </a>
                        <div class="card-body">
                                <h5 class="card-title">
                                    <strong>Titre : </strong>
                                    {{ video.titre }}
                                </h5>
                            <div class="card-text">
                                <strong>Description :</strong>
                                {{ video.description }}
                            </div>
                            
                            <strong>Genre : </strong>
                            {{ video.categorie }}
                        </div>
                        
                        <a href="{{path("video_like",{'id': video.id})}}"class="btn btn-link js-like">
                        {% if app.user and video.isLikedByUser(app.user) %}
                            <i class="fa fa-thumbs-up in" ></i>
                        {% else %}
                            <i class="fa fa-thumbs-o-up in"></i>
                        {% endif %}
                            <span class="js-likes">{{video.likes | length}}</span>
                            <span class="js-label">J'aime</span>
                        </a>
                                           
                                                            
                    </div>
                {% endfor %}
            </div>        
        
        {% else %}
            <div class="col-12">
                <h4>
                    Aucune video 
                </h4>
            </div>
        {% endif %}
{% endblock %}
{% block javascripts %}
    
    <script>

        function onClickBtnLike(event){
        event.preventDefault();

        const url = this.href;
        const spanCount = this.querySelector('span.js-likes');
        const icone = this.querySelector('i.in');

        axios.get(url).then(function(response) {
            
            spanCount.textContent = response.data.likes;
            if(icone.classList.contains('fa-thumbs-up')) {

                icone.classList.replace('fa-thumbs-up', 'fa-thumbs-o-up');
            }
            else {
                icone.classList.replace('fa-thumbs-o-up', 'fa-thumbs-up');
            }
        }).catch(function(error){
            if(error.response.status === 403){
                alert("Vous devez etre connecter pour liker une video");
            }else {
                alert("Une erreur s'est produite, réessayez plus tard");
            }
        })
    }


    document.querySelectorAll('a.js-like').forEach(function(link){
        link.addEventListener('click', onClickBtnLike);
    })

    </script>

{% endblock %}
